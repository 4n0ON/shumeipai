<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.4.10"/><meta name="created" content="2013-07-29T14:40:43Z"/><meta name="updated" content="2013-07-29T14:40:43Z"/><title>使用 ip tunnel 建立 VPN » Technical Blog</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><div style="clear: both; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 772.15625px; overflow: hidden; padding: 15px 0px 5px; text-decoration: initial; width: 693px;">
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">在国内的上网环境下，使用 VPN 的好处显而易见。</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 44px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">有一种 ip tunnel 模式叫 ipip，是我见过搭建 VPN 最简单的方式，但是它有一个前提，即作为网关的两台机器都要有公网 IP，而且支持 ipip 数据包收发。</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">达成这两个条件以后，我们就可以花两分钟时间快速搭建 VPN 。</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 44px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">假如 A 网络的网关机器公网 IP 为 207.47.0.1，B 网络的网关机器公网 IP 为 207.47.34.10。然后设定目标 VPN 私网网段为 192.168.10.0/24。</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 44px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">我们首先在 A 机器上配置，以 Debian 为例，编辑 /etc/network/interfaces 文件，添加一个虚拟网络设备 sit0，具体配置如下：</p>
<div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 0px; padding: 0px; text-decoration: initial; width: 693px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 13.920000076293945px 0px; overflow: auto; padding: 0px; position: relative; text-decoration: initial; width: 693px; background-position: 0% 0%; background-repeat: repeat repeat;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(212, 208, 200); background-size: auto; border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: none; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 11px; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; position: absolute; right: 1px; text-align: left; text-decoration: initial; top: 1px; width: 11px; z-index: 10; background-position: 0% 0%; background-repeat: repeat repeat;"><span style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; text-align: left; text-decoration: initial;"><a href="http://dola.xinfan.org/?p=252#" style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 1px 0px 0px; text-align: center; text-decoration: initial;">?</a></span></div><table border="0" cellpadding="0" cellspacing="0" style="display: table; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tbody style="display: table-row-group; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tr style="display: table-row; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><td style="border: 0px none rgb(120, 120, 120); color: rgb(120, 120, 120); display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px; text-align: left; text-decoration: initial; width: 32px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">1</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">2</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">3</div></td><td style="display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 661px;"><div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; position: relative; text-align: left; text-decoration: initial; width: 661px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip tunnel add iptun0 mode ipip remote 207.47.34.10 local 210.47.0.1</code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip link set iptun0 up</code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip addr add 192.168.10.11/24 dev iptun0</code></div></div></td></tr></tbody></table></div></div>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">同样在 B 机器上配置，编辑 /etc/network/interfaces 文件，添加一个虚拟网络设备 sit0，具体配置如下：</p>
<div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 0px; padding: 0px; text-decoration: initial; width: 693px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 13.920000076293945px 0px; overflow: auto; padding: 0px; position: relative; text-decoration: initial; width: 693px; background-position: 0% 0%; background-repeat: repeat repeat;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(212, 208, 200); background-size: auto; border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: none; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 11px; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; position: absolute; right: 1px; text-align: left; text-decoration: initial; top: 1px; width: 11px; z-index: 10; background-position: 0% 0%; background-repeat: repeat repeat;"><span style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; text-align: left; text-decoration: initial;"><a href="http://dola.xinfan.org/?p=252#" style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 1px 0px 0px; text-align: center; text-decoration: initial;">?</a></span></div><table border="0" cellpadding="0" cellspacing="0" style="display: table; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tbody style="display: table-row-group; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tr style="display: table-row; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><td style="border: 0px none rgb(120, 120, 120); color: rgb(120, 120, 120); display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px; text-align: left; text-decoration: initial; width: 32px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">1</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">2</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">3</div></td><td style="display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 661px;"><div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; position: relative; text-align: left; text-decoration: initial; width: 661px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip tunnel add iptun0 mode ipip remote 210.47.0.1 local 207.47.34.10</code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip link set iptun0 up</code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">ip addr add 192.168.10.12/24 dev iptun0</code></div></div></td></tr></tbody></table></div></div>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">配置完成后分别重启两台机器的网络：</p>
<div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 15px; margin: 0px; padding: 0px; text-decoration: initial; width: 693px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 15px; margin: 13.920000076293945px 0px; overflow: auto; padding: 0px; position: relative; text-decoration: initial; width: 693px; background-position: 0% 0%; background-repeat: repeat repeat;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(212, 208, 200); background-size: auto; border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: none; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 11px; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; position: absolute; right: 1px; text-align: left; text-decoration: initial; top: 1px; width: 11px; z-index: 10; background-position: 0% 0%; background-repeat: repeat repeat;"><span style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; text-align: left; text-decoration: initial;"><a href="http://dola.xinfan.org/?p=252#" style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 1px 0px 0px; text-align: center; text-decoration: initial;">?</a></span></div><table border="0" cellpadding="0" cellspacing="0" style="display: table; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tbody style="display: table-row-group; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tr style="display: table-row; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><td style="border: 0px none rgb(120, 120, 120); color: rgb(120, 120, 120); display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px; text-align: left; text-decoration: initial; width: 32px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">1</div></td><td style="display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 661px;"><div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; position: relative; text-align: left; text-decoration: initial; width: 661px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="border: 0px none rgb(63, 95, 191); color: rgb(63, 95, 191); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(63, 95, 191) none 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;"># /etc/init.d/networking restart</code></div></div></td></tr></tbody></table></div></div>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">正常情况下这样两台机器就处在同一个私网网段中了，可以用 /sbin/ifconfig 看到 iptun0 设备。</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">如果 A 机器要能过 B 机器上网，只要将 A 机器的路由指向 B机器，同时打开 B 机器的 NAT 和 IP 地址转发：</p>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">在 A 上执行：</p>
<div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 15px; margin: 0px; padding: 0px; text-decoration: initial; width: 693px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 15px; margin: 13.920000076293945px 0px; overflow: auto; padding: 0px; position: relative; text-decoration: initial; width: 693px; background-position: 0% 0%; background-repeat: repeat repeat;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(212, 208, 200); background-size: auto; border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: none; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 11px; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; position: absolute; right: 1px; text-align: left; text-decoration: initial; top: 1px; width: 11px; z-index: 10; background-position: 0% 0%; background-repeat: repeat repeat;"><span style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; text-align: left; text-decoration: initial;"><a href="http://dola.xinfan.org/?p=252#" style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 1px 0px 0px; text-align: center; text-decoration: initial;">?</a></span></div><table border="0" cellpadding="0" cellspacing="0" style="display: table; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tbody style="display: table-row-group; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tr style="display: table-row; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><td style="border: 0px none rgb(120, 120, 120); color: rgb(120, 120, 120); display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px; text-align: left; text-decoration: initial; width: 32px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">1</div></td><td style="display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 661px;"><div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px; position: relative; text-align: left; text-decoration: initial; width: 661px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;">＃ ip route replace default via 192.168.10.12 dev iptun0</code></div></div></td></tr></tbody></table></div></div>
<p style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 22px; margin: 0px 0px 20.880001068115234px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;">在 B 上执行：</p>
<div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 0px; padding: 0px; text-decoration: initial; width: 693px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 22.265625px; font-family: Arial, Helvetica, sans-serif; height: 45px; margin: 13.920000076293945px 0px; overflow: auto; padding: 0px; position: relative; text-decoration: initial; width: 693px; background-position: 0% 0%; background-repeat: repeat repeat;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(212, 208, 200); background-size: auto; border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: none; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 11px; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; position: absolute; right: 1px; text-align: left; text-decoration: initial; top: 1px; width: 11px; z-index: 10; background-position: 0% 0%; background-repeat: repeat repeat;"><span style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 0px; text-align: left; text-decoration: initial;"><a href="http://dola.xinfan.org/?p=252#" style="border: 0px none rgb(160, 160, 160); color: rgb(160, 160, 160); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: 13.1875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(160, 160, 160) none 0px; padding: 1px 0px 0px; text-align: center; text-decoration: initial;">?</a></span></div><table border="0" cellpadding="0" cellspacing="0" style="display: table; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tbody style="display: table-row-group; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><tr style="display: table-row; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 693px;"><td style="border: 0px none rgb(120, 120, 120); color: rgb(120, 120, 120); display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px; text-align: left; text-decoration: initial; width: 32px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">1</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">2</div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; color: rgb(120, 120, 120); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; outline: rgb(120, 120, 120) none 0px; padding: 0px 6.953125px 0px 13.90625px; text-align: right; text-decoration: initial; white-space: pre; width: 8.140625px; background-position: 0% 0%; background-repeat: repeat repeat;">3</div></td><td style="display: table-cell; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; text-align: left; text-decoration: initial; width: 661px;"><div style="display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 45px; margin: 0px; padding: 0px; position: relative; text-align: left; text-decoration: initial; width: 661px;"><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="border: 0px none rgb(63, 95, 191); color: rgb(63, 95, 191); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(63, 95, 191) none 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="border: 0px none rgb(63, 95, 191); color: rgb(63, 95, 191); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(63, 95, 191) none 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;"># iptables -t nat -A POSTROUTING -m conntrack --ctstate DNAT -j MASQUERADE </code></div><div style="background-image: none; background-attachment: scroll; background-origin: padding-box; background-clip: border-box; background-color: rgb(255, 255, 255); background-size: auto; display: block; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; height: 15px; margin: 0px; padding: 0px 13.90625px; text-align: left; text-decoration: initial; white-space: pre; width: 633.1875px; background-position: 0% 0%; background-repeat: repeat repeat;"><code style="border: 0px none rgb(63, 95, 191); color: rgb(63, 95, 191); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-size: 14px; line-height: 15.296875px; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; margin: 0px; outline: rgb(63, 95, 191) none 0px; padding: 0px; text-align: left; text-decoration: initial; white-space: pre;"># iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -o eth0 -j MASQUERADE</code></div></div></td></tr></tbody></table></div></div>
			</div></div></body></html>